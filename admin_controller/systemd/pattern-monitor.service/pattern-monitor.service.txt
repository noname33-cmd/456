[Unit]
Description=Pattern Controller - Monitor UI (35072)
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
Environment=PC_BASE=/tmp/pattern_controller
EnvironmentFile=/etc/pattern-controller.env
WorkingDirectory=/tmp/pattern_controller
ExecStart=/usr/bin/python3 /usr/local/bin/monitor_35072.py \
  --flag-dir /tmp/pattern_controller/signals \
  --controller-report-dir /tmp/pattern_controller/report \
  --worker-report-dirs /tmp/pattern_controller/report \
  --error-log-dir /tmp/pattern_controller/logs \
  --port ${MON_PORT} \
  --refresh-sec 5 \
  --toggle-secret ${TOGGLE_SECRET} \
  --haproxy-ops-queue /tmp/pattern_controller/signals/haproxy_ops \
  --haproxy-socket ${HAPROXY_SOCKET} \
  --haproxy-tcp ${HAPROXY_TCP} \
  --haproxy-cfg ${HAPROXY_CFG} \
  --haproxy-reload-cmd "${HAPROXY_RELOAD_CMD}" \
  --haproxy-backends "${HAPROXY_BACKENDS}" \
  --haproxy-parse-interval ${HAPROXY_PARSE_INTERVAL} \
  --peer-tabs "${PEER_TABS}" \
  --workers ${MON_WORKERS}
Restart=on-failure
RestartSec=3
User=root
StandardOutput=append:/tmp/pattern_controller/logs/master_monitor.log
StandardError=append:/tmp/pattern_controller/logs/master_monitor.err

[Install]
WantedBy=multi-user.target
